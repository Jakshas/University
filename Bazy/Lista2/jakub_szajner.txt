SELECT DISTINCT a.City 
FROM SalesLT.Address a 
WHERE EXISTS (
	SELECT 1 
	FROM SalesLT.SalesOrderHeader H 
	WHERE H.ShipToAddressID = a.AddressID) 
ORDER BY City


SELECT M.Name, COUNT(P.ProductID)
FROM SalesLT.ProductModel M, SalesLT.Product P
WHERE M.ProductModelID = P.ProductModelID
GROUP BY M.Name
HAVING COUNT(P.ProductID) > 1


SELECT A.City, COUNT(CA.CustomerID), COUNT(DISTINCT C.SalesPerson)
From SalesLT.Address A,SalesLT.CustomerAddress CA, SalesLT.Customer C
WHERE A.AddressID = CA.AddressID AND C.CustomerID = CA.AddressID
GROUP BY A.City



SELECT C.Name, P.Name 
FROM SalesLT.Product P, SalesLT.ProductCategory C
WHERE C.ProductCategoryID = P.ProductCategoryID AND EXISTS (
	SELECT 1 
	FROM SalesLT.ProductCategory 
	WHERE  C.ProductCategoryID = ParentProductCategoryID)



SELECT C.FirstName, C.LastName, SUM(SalesLT.SalesOrderDetail.UnitPriceDiscount * SalesLT.SalesOrderDetail.OrderQty)
FROM SalesLT.Customer C 
INNER JOIN SalesLT.SalesOrderHeader 
ON C.CustomerID = SalesLT.SalesOrderHeader.CustomerID
INNER JOIN SalesLT.SalesOrderDetail
ON SalesLT.SalesOrderDetail.SalesOrderID = SalesLT.SalesOrderHeader.SalesOrderID
GROUP BY C.FirstName, C.LastName
HAVING NOT SUM(SalesLT.SalesOrderDetail.UnitPriceDiscount * SalesLT.SalesOrderDetail.OrderQty) = 0




CREATE TABLE Test (
    ID int NOT NULL IDENTITY(1000, 10),
    Name varchar(50), 
    PRIMARY KEY (ID)
);

INSERT INTO dbo.Test (Name) VALUES('abc')

SELECT @@IDENTITY

SELECT IDENT_CURRENT ('dbo.Test')




SELECT * 
FROM INFORMATION_SCHEMA.CHECK_CONSTRAINTS

ALTER TABLE SalesLT.SalesOrderHeader
ADD CONSTRAINT c CHECK ([ShipDate]>=[OrderDate] OR [ShipDate] IS NULL);

ALTER TABLE SalesLT.SalesOrderHeader
DROP CONSTRAINT c

UPDATE SalesLT.SalesOrderHeader
SET OrderDate = '2009/06/08' WHERE	SalesOrderID = 71774




ALTER TABLE SalesLT.Customer 
ADD CreditCardNumber varchar(10);

UPDATE SalesLT.SalesOrderHeader
SET CreditCardApprovalCode = 1234
WHERE SalesOrderID = 71774;
UPDATE SalesLT.SalesOrderHeader
SET CreditCardApprovalCode = 2345
WHERE SalesOrderID = 71776;
UPDATE SalesLT.SalesOrderHeader
SET CreditCardApprovalCode = 3456
WHERE SalesOrderID = 71780;

UPDATE SalesLT.Customer
SET CreditCardNumber='X'
FROM SalesLT.Customer
INNER JOIN SalesLT.SalesOrderHeader
ON SalesLT.Customer.CustomerID = SalesLT.SalesOrderHeader.CustomerID
WHERE SalesLT.SalesOrderHeader.CreditCardApprovalCode IS NOT NULL




CREATE TABLE M1 (
    K int NOT NULL IDENTITY(1, 1),
    V varchar(20),
    PRIMARY KEY (K)
);

CREATE TABLE S1 (
    K int NOT NULL IDENTITY(1, 1),
	MKF int,
    V varchar(20),
    PRIMARY KEY (K),
	FOREIGN KEY (MKF) REFERENCES M1(K)
);

CREATE TABLE M2 (
    K1 int NOT NULL,
	K2 int NOT NULL,
    V varchar(20),
    PRIMARY KEY (K1,K2)
);

CREATE TABLE S2 (
    K int NOT NULL IDENTITY(1, 1),
	MK1F int,
	MK2F int,
    V varchar(20),
    PRIMARY KEY (K),
	FOREIGN KEY (MK1F, MK2F) REFERENCES M2(K1 ,K2)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

INSERT INTO M2(K1,K2,V)
VALUES (1,1,'a'),(2,2,'a'),(3,3,'a')

INSERT INTO S2(MK1F,MK2F,V)
VALUES (1,1,'a'),(2,2,'a'),(3,3,'a') --,(4,4,'a')

UPDATE M2
SET K2 = 1, K1 = 1
WHERE K2 = 4 AND K1 = 4

DELETE FROM M2 WHERE K2 = 1 AND K1 = 1
